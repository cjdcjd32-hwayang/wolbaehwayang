<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì›”ë°°ê¶Œ ë³´ì€ì˜ ì—¬ìë¶€</title>

  <!-- ë°°ê²½ & ê¸°ë³¸ ìŠ¤íƒ€ì¼ -->
  <style>
    body {
      margin: 0;
      font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
      background: url('https://images.unsplash.com/photo-1500530855697-b586d89ba3ee') center/cover no-repeat fixed;
      color: #222;
    }
    header {
      text-align: center;
      padding: 20px;
      background: rgba(255,255,255,0.8);
    }
    nav {
      display: flex;
      justify-content: space-around;
      background: rgba(255,255,255,0.9);
      position: sticky;
      top: 0;
    }
    nav button {
      flex: 1;
      padding: 12px;
      border: none;
      background: none;
      font-size: 15px;
      cursor: pointer;
    }
    section {
      display: none;
      padding: 16px;
      background: rgba(255,255,255,0.85);
      margin: 12px;
      border-radius: 12px;
    }
    section.active { display: block; }

    /* ì˜¨ë„ê³„ */
    .thermometer {
      width: 60px;
      height: 260px;
      border: 3px solid #555;
      border-radius: 30px;
      margin: 0 auto;
      position: relative;
      background: #fff;
      overflow: hidden;
    }
    .thermo-fill {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 0%;
      background: linear-gradient(to top, #1e90ff, #ffd700, #ff4500);
      transition: height 0.5s;
    }
    .thermo-lines {
      position: absolute;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(
        to top,
        transparent,
        transparent 18px,
        rgba(0,0,0,0.15) 19px
      );
      pointer-events: none;
    }

    .branch-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 16px;
    }
    .branch-card {
      text-align: center;
    }

    /* ì…ë ¥ */
    input, select, button {
      padding: 10px;
      margin: 6px 0;
      width: 100%;
      font-size: 14px;
    }
    .admin { border: 2px dashed #c00; padding: 12px; }
  </style>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, doc, setDoc, addDoc, getDocs, query, where, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBau9yukCvYTsahSkjy0JndEk4Docmue1I",
      authDomain: "wolbaehwayang-d1787.firebaseapp.com",
      projectId: "wolbaehwayang-d1787"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    /* íƒ­ */
    window.showTab = (id) => {
      document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    };

    /* ë‹‰ë„¤ì„ */
    window.saveNickname = async () => {
      const nick = document.getElementById('nicknameInput').value.trim();
      if (!nick) return alert('ë‹‰ë„¤ì„ ì…ë ¥');
      localStorage.setItem('nickname', nick);
      await setDoc(doc(db, 'users', nick), { nickname: nick, createdAt: serverTimestamp() }, { merge: true });
      alert('ì…ì¥ ì™„ë£Œ');
    };

    /* ì°½ì œ ê¸°ë¡ (1ì¼ 3íšŒ ì œí•œ) */
    window.saveChant = async () => {
      const nick = localStorage.getItem('nickname');
      if (!nick) return alert('ë‹‰ë„¤ì„ í•„ìš”');
      const branch = document.getElementById('branch').value;
      const minutes = Number(document.getElementById('minutes').value);
      const today = new Date().toISOString().slice(0,10);

      const q = query(collection(db, 'chants'), where('nickname','==',nick), where('date','==',today));
      const snap = await getDocs(q);
      if (snap.size >= 3) return alert('í•˜ë£¨ 3íšŒ ì œí•œ');

      await addDoc(collection(db,'chants'),{
        nickname:nick,
        branch,
        minutes,
        blocks: minutes===10?1:2,
        date: today,
        createdAt: serverTimestamp()
      });
      alert('ì €ì¥ ì™„ë£Œ');
    };

    /* ê´€ë¦¬ì ì›”ë³„ ë¦¬ì…‹ (í‘œì‹œìš©) */
    window.adminReset = () => {
      const code = prompt('RESET ì…ë ¥');
      if (code==='RESET') alert('ê´€ë¦¬ì ë¦¬ì…‹ ì‹¤í–‰ (Firestoreì—ì„œ ì›”ë³„ ë¬¸ì„œ ì‚­ì œ)');
    };

  </script>
</head>
<body>

<header>
  <h1>ğŸŒ¸ ì›”ë°°ê¶Œ ë³´ì€ì˜ ì—¬ìë¶€</h1>
</header>

<nav>
  <button onclick="showTab('home')">í™ˆ</button>
  <button onclick="showTab('chant')">ğŸŒ± ì°½ì œ</button>
  <button onclick="showTab('activity')">í™œë™</button>
  <button onclick="showTab('schedule')">ì¼ì •</button>
  <button onclick="showTab('school')">ìŠ¤ì¿¨</button>
  <button onclick="showTab('admin')">ê´€ë¦¬ì</button>
</nav>

<section id="home" class="active">
  <h2>ì§€ë¶€ë³„ ì˜¨ë„ê³„</h2>
  <div class="branch-grid">
    <div class="branch-card">
      <p>ë‹¬ë¹„</p>
      <div class="thermometer"><div class="thermo-fill" style="height:40%"></div><div class="thermo-lines"></div></div>
    </div>
    <div class="branch-card">
      <p>ìƒì¸</p>
      <div class="thermometer"><div class="thermo-fill" style="height:65%"></div><div class="thermo-lines"></div></div>
    </div>
  </div>
</section>

<section id="chant">
  <h2>ğŸŒ± ì°½ì œ ê¸°ë¡</h2>
  <input id="nicknameInput" placeholder="ë‹‰ë„¤ì„" />
  <button onclick="saveNickname()">ë‹‰ë„¤ì„ ì €ì¥</button>
  <select id="branch"><option>ë‹¬ë¹„</option><option>ìƒì¸</option></select>
  <select id="minutes"><option value="10">10ë¶„</option><option value="30">30ë¶„</option></select>
  <button onclick="saveChant()">ê¸°ë¡ ì €ì¥</button>
</section>

<section id="activity">
  <h2>í™œë™ ê¸°ë¡</h2>
  <p>ë‹‰ë„¤ì„ + ëŒ€ìƒì ì…ë ¥ ë°©ì‹ (êµ¬í˜„ í™•ì¥ ê°€ëŠ¥)</p>
</section>

<section id="schedule">
  <h2>ì´ë‹¬ì˜ ì¼ì •</h2>
  <p>ì „ì²´ ì‚¬ìš©ì ì°½ì œ í•©ì‚° ë‹¬ë ¥ ì˜ì—­</p>
</section>

<section id="school">
  <h2>ìŠ¤ì¿¨</h2>
  <p>êµìœ¡ / ê³µì§€ íƒ­</p>
</section>

<section id="admin" class="admin">
  <h2>ê´€ë¦¬ì íŒ¨ë„</h2>
  <button onclick="adminReset()">ì›”ë³„ ë¦¬ì…‹</button>
</section>

</body>
</html>
