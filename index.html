<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Wolbaehwayang</title>
</head>

<body>
<h1>ğŸŒ± Wolbaehwayang</h1>

<div id="nicknameBox">
  <h2>ë‹‰ë„¤ì„ ì…ë ¥</h2>
  <input id="nicknameInput" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" maxlength="10">
  <button id="saveNicknameBtn">ì…ì¥í•˜ê¸°</button>
  <p id="statusMsg"></p>
</div>

<hr>

<h2>ğŸŒ± ì°½ì œ ê¸°ë¡</h2>

<select id="branchSelect">
  <option value="">ì†Œì† ì§€ë¶€ ì„ íƒ</option>
  <option value="ë‹¬ë¹„">ë‹¬ë¹„</option>
  <option value="ìƒì¸">ìƒì¸</option>
  <option value="ì›ë•">ì›ë•</option>
  <option value="ëŒ€ê³¡">ëŒ€ê³¡</option>
  <option value="ì›”ë°°">ì›”ë°°</option>
  <option value="ìœ ì²œ">ìœ ì²œ</option>
  <option value="ì§„ì²œ">ì§„ì²œ</option>
  <option value="ì˜ë‚¨">ì˜ë‚¨</option>
  <option value="ì˜¥í¬">ì˜¥í¬</option>
  <option value="í™”ì›">í™”ì›</option>
</select>

<select id="timeSelect">
  <option value="">ì°½ì œ ì‹œê°„ ì„ íƒ</option>
  <option value="10">10ë¶„</option>
  <option value="30">30ë¶„</option>
  <option value="60">1ì‹œê°„</option>
</select>

<button id="saveChantBtn">ì°½ì œ ê¸°ë¡ ì €ì¥</button>
<p id="chantMsg"></p>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, doc, setDoc, addDoc, collection, serverTimestamp } 
    from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBau9yukCvYTsahSkjy0JndEk4Docmue1I",
    authDomain: "wolbaehwayang-d1787.firebaseapp.com",
    projectId: "wolbaehwayang-d1787"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  console.log("ğŸ”¥ Firebase ì—°ê²° ì™„ë£Œ");

  // ë‹‰ë„¤ì„ ìë™ ì…ì¥
  const savedNickname = localStorage.getItem("wolbaehwayang_nickname");
  if (savedNickname) {
    document.getElementById("nicknameBox").style.display = "none";
  }

  // ë‹‰ë„¤ì„ ì €ì¥
  document.getElementById("saveNicknameBtn").addEventListener("click", async () => {
    const nickname = document.getElementById("nicknameInput").value.trim();
    const msg = document.getElementById("statusMsg");

    if (!nickname) {
      msg.innerText = "ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
      msg.style.color = "red";
      return;
    }

    await setDoc(doc(db, "users", nickname), {
      nickname,
      createdAt: serverTimestamp()
    });

    localStorage.setItem("wolbaehwayang_nickname", nickname);
    msg.innerText = "ì…ì¥ ì™„ë£Œ!";
    msg.style.color = "green";
    document.getElementById("nicknameBox").style.display = "none";
  });

  // ì°½ì œ ê¸°ë¡
  document.getElementById("saveChantBtn").addEventListener("click", async () => {
    const nickname = localStorage.getItem("wolbaehwayang_nickname");
    const branch = document.getElementById("branchSelect").value;
    const minutes = Number(document.getElementById("timeSelect").value);
    const chantMsg = document.getElementById("chantMsg");

    if (!nickname || !branch || !minutes) {
      chantMsg.innerText = "ë‹‰ë„¤ì„, ì§€ë¶€, ì‹œê°„ì„ ëª¨ë‘ ì„ íƒí•˜ì„¸ìš”.";
      chantMsg.style.color = "red";
      return;
    }

    await addDoc(collection(db, "chants"), {
      nickname,
      branch,
      minutes,
      blocks: minutes / 10,
      createdAt: serverTimestamp()
    });

    chantMsg.innerText = "ì°½ì œ ê¸°ë¡ ì €ì¥ ì™„ë£Œ ğŸŒ±";
    chantMsg.style.color = "green";
  });
</script>
</body>
</html>
